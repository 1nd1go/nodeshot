Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};
var nodeshot={nodes:[],status_choices:{a:"active",h:"hotspot",p:"potential"},url:{index:"",media:""},init:function(){nodeshot.getNodes();nodeshot.layout.cacheObjects();nodeshot.layout.initSideControl();nodeshot.gmap.init();nodeshot.remember();nodeshot.layout.initSearchAddress();nodeshot.layout.initMainSearch();nodeshot.layout.initAddNode();nodeshot.layout.initChoices();nodeshot.layout.initPotential();nodeshot.layout.initLinkQuality();nodeshot.layout.initNodeTree();nodeshot.easterEgg()},getNodes:function(){$.getJSON(nodeshot.url.index+
"nodes.json",function(a){nodeshot.nodes=a})},remember:function(){if($.cookie("nodeshot_potential_nodes")=="false")nodeshot.layout.$potential[0].checked=!1;if($.cookie("nodeshot_link_quality")=="dbm")$("#dbm")[0].checked=!0;$.cookie("nodeshot_sidebar")=="false"&&nodeshot.layout.$hideSide.trigger("click");nodeshot.distance.cookie=$.cookie("nodeshot_saved_distances");if(nodeshot.distance.cookie&&(nodeshot.distance.saved_links=JSON.parse(nodeshot.distance.cookie),typeof nodeshot.distance.saved_links==
"object"&&(len=nodeshot.distance.saved_links.length+1,ilen=len-1,len>0)))for(;--len;)nodeshot.gmap.drawDistanceLink(nodeshot.distance.saved_links[ilen-len],"saved")},layout:{cacheObjects:function(){this.$body=$("body");this.$container=$("#container");this.$header=$("#header");this.$content=$("#content");this.$aside=$("#aside");this.$nodeTreeContainer=$("#node-tree-container");this.$nodeTree=$("#node-tree");this.$hideSide=$("#hide-side");this.$search=$("#search");this.$addNode=$("#addnode");this.$choices=
$("#choices");this.$potential=$("#potential");this.$linkQuality=$("#link-quality")},setFullScreen:function(){var a=$(window);a.width()>950&&(this.$container.width(a.width()),this.$header.width(a.width()),nodeshot.layout.$aside.hidden?this.$content.width(a.width()):(this.$content.width(a.width()-295),this.$aside.width("295")));this.$map?this.$map.height(a.height()-this.$header.height()):this.$infoWrapper.height(a.height()-this.$header.height());a=this.$container.height()-this.$header.height()-this.$nodeTreeContainer.position().top;
a>200&&this.$nodeTreeContainer.height(a)},setElementDimensions:function(){this.$header.css({position:"absolute",top:0,left:0});this.$content.css({position:"absolute",marginTop:this.$header.height(),left:0});this.$aside.css({marginTop:this.$header.height()})},getCssInt:function(a){a?(a=a.replace("px",""),a=a.replace("em",""),a.replace("%",""),integer=parseInt(a)):integer=0;return integer},horizontalCenter:function(a){if(a){var b=this.getCssInt(a.css("padding-left")),c=this.getCssInt(a.css("padding-right")),
d=this.getCssInt(a.css("border-left-width")),e=this.getCssInt(a.css("border-right-width"));width=a.width()+b+c+d+e;return($(window).width()-width)/2}},verticalCenter:function(a){if(a){var b=this.getCssInt(a.css("padding-top")),c=this.getCssInt(a.css("padding-bottom")),d=this.getCssInt(a.css("border-top-width")),e=this.getCssInt(a.css("border-bottom-width"));height=a.height()+b+c+d+e;return($(window).height()-height)/2}},bindFocusBlur:function(a){a.focus(function(){a.val()==a[0].defaultValue&&a.val("")});
a.blur(function(){$(this).val()==""&&$(this).val(a[0].defaultValue)})},initSearchAddress:function(){$("#search-address").click(function(a){a.preventDefault();nodeshot.gmap.infoWindow&&nodeshot.gmap.infoWindow.close();nodeshot.overlay.addMask();nodeshot.overlay.open('<div id="nodeshot-overlay-inner" class="content narrower"><div id="gmap-search"><h3>Cerca un indirizzo</h3><p>Inserisci l\'indirizzo completo</p><p><input type="text" class="text" id="gmap-address" /><input class="button" type="submit" value="Cerca" id="gmap-submit" /></p></div></div>',
!1,nodeshot.gmap.removeNewMarker);var b=$("#gmap-address");b.trigger("focus");b.bind("keyup",function(a){(a.keyCode?a.keyCode:a.which)==13&&b.val()!=""?nodeshot.gmap.searchAddress(b.val(),b):b.hasClass("error")&&b.removeClass("error")});$("#gmap-submit").click(function(){nodeshot.gmap.searchAddress(b.val(),b)})})},initSideControl:function(){this.$body.append('<a id="show-column"></a>');this.$showColumn=$("#show-column");this.$hideSide.click(function(a){a.preventDefault();nodeshot.layout.$body.css("overflow",
"hidden");nodeshot.layout.$aside.css({right:0,position:"absolute"});nodeshot.layout.$aside.animate({right:-300},500,function(){nodeshot.layout.$aside.hide();nodeshot.layout.$aside.hidden=!0});nodeshot.layout.$content.animate({width:nodeshot.layout.$header.width()},500,function(){nodeshot.layout.$showColumn.show(500)});setTimeout(function(){nodeshot.layout.setFullScreen();nodeshot.layout.$body.css("overflow","auto")},600);$.cookie("nodeshot_sidebar","false",{expires:365,path:nodeshot.url.index})});
this.$showColumn.css("opacity",0.5).hover(function(){nodeshot.layout.$showColumn.fadeTo(250,1)},function(){nodeshot.layout.$showColumn.fadeTo(250,0.5)}).click(function(){nodeshot.layout.$body.css("overflow","hidden");nodeshot.layout.$aside.show().animate({right:0},function(){nodeshot.layout.$aside.hidden=!1;nodeshot.layout.$aside.css("position","static")});nodeshot.layout.$content.animate({width:$(window).width()-295});nodeshot.layout.$showColumn.hide(500);setTimeout(function(){nodeshot.layout.setFullScreen();
nodeshot.layout.$body.css("overflow","auto")},600);$.cookie("nodeshot_sidebar","true",{expires:365,path:nodeshot.url.index})})},initMainSearch:function(){nodeshot.mainSearchCache=[];this.bindFocusBlur(this.$search);this.$search.autocomplete({minLength:3,source:function(a,b){var c=a.term;c in nodeshot.mainSearchCache?b(nodeshot.mainSearchCache[c]):lastXhr=$.getJSON("search/"+a.term+"/",function(a,c,f){f===lastXhr&&a!=null&&a.length>0?b(a):b("")})},select:function(a,b){var c=nodeshot.layout.$choices.find("input:checked").val();
if(c=="map")nodeshot.gmap.goToNode(nodeshot.nodes[nodeshot.status_choices[b.item.status]][b.item.value]);else if(c=="info")nodeshot.infoTab.scrollTo(b.item.slug);else return!1;$(this).val(b.item.label);return!1},focus:function(a,b){$(this).val(b.item.label);return!1}})},initAddNode:function(){this.$addNode.click(function(){nodeshot.dialog.open("Fai click sul punto della mappa dove vorresti mettere il tuo nodo. Cerca di essere preciso :)");nodeshot.gmap.clickListener=google.maps.event.addListener(nodeshot.gmap.map,
"click",function(a){nodeshot.gmap.newNodeMarker(a.latLng)})})},initChoices:function(){this.$choices.buttonset();document.getElementById("radio1").checked=!0;document.getElementById("radio2").checked=!1;document.getElementById("radio3").checked=!1;document.getElementById("radio4").checked=!1;this.$choices.buttonset("refresh");this.$choices.find("input").change(function(){var a=this.value;a=="map"?(nodeshot.layout.$infoTable&&nodeshot.infoTab.unload(),nodeshot.overlay.addMask(0.7),nodeshot.overlay.showLoading(),
nodeshot.layout.$content.html('<div id="map_canvas"></div><div id="side-links"></div>'),nodeshot.gmap.init(),nodeshot.remember()):a=="info"?(nodeshot.gmap.unload(),nodeshot.overlay.addMask(0.7),nodeshot.overlay.showLoading(),nodeshot.layout.$content.load(nodeshot.url.index+"info_tab",function(){nodeshot.infoTab.init();nodeshot.layout.setFullScreen();nodeshot.overlay.removeMask();nodeshot.overlay.hideLoading()})):a=="olsr"?nodeshot.layout.$content.html("<img src='http://tuscolomesh.ninux.org/images/topology.png' width='100%' height='700px' />"):
a=="vpn"&&nodeshot.layout.$content.html("<img src='http://zioproto.ninux.org/download/file.png' width='100%' height='700px' />")})},initLinkQuality:function(){nodeshot.layout.$linkQuality.find("input").change(function(){$.cookie("nodeshot_link_quality",this.id,{expires:365,path:nodeshot.url.index});nodeshot.gmap.removeMarkers("active");nodeshot.gmap.drawNodes("active")})},initPotential:function(){nodeshot.layout.$potential.change(function(){this.checked?($.cookie("nodeshot_potential_nodes","true",
{expires:365,path:nodeshot.url.index}),nodeshot.gmap.drawNodes(nodeshot.status_choices.p)):($.cookie("nodeshot_potential_nodes","false",{expires:365,path:nodeshot.url.index}),nodeshot.gmap.removeMarkers(nodeshot.status_choices.p))})},initNodeTree:function(){this.$nodeTree.jstree({json_data:{ajax:{url:nodeshot.url.index+"node_list.json",data:function(a){return{id:a.attr?a.attr("id"):0}}}},themes:{theme:"classic"},plugins:["themes","json_data"]})}},overlay:{addMask:function(a,b){if(document.getElementById("nodeshot-mask")!=
null)return!1;a||(a=0.5);$("body").append('<div id="nodeshot-mask"></div>');var c=$("#nodeshot-mask");c.css({opacity:0,display:"block"}).animate({opacity:a},500);b&&c.click(function(){nodeshot.overlay.removeMask();nodeshot.layout.$dialog&&nodeshot.dialog.close()})},removeMask:function(){var a=$("#nodeshot-mask");if(a.length<1)return!1;a.fadeOut(500,function(){a.remove()})},appendLoading:function(){$("body").append('<img src="'+nodeshot.url.media+'images/ajax-loader.gif" alt="" id="nodeshot-ajaxloader" />');
nodeshot.layout.$loading=$("#nodeshot-ajaxloader")},showLoading:function(){nodeshot.layout.$loading.css({left:nodeshot.layout.horizontalCenter(nodeshot.layout.$loading),top:nodeshot.layout.verticalCenter(nodeshot.layout.$loading)})},hideLoading:function(){nodeshot.layout.$loading.css("top","-9999px")},open:function(a,b){this.hideLoading();nodeshot.layout.$overlay&&nodeshot.layout.$overlay.remove();nodeshot.layout.$body.append('<div id="nodeshot-overlay"></div>');nodeshot.layout.$overlay=$("#nodeshot-overlay");
nodeshot.layout.$overlay.html(a);nodeshot.layout.$overlayInner=$("#nodeshot-overlay-inner");this.initClose();this.centerVertically();nodeshot.layout.setFullScreen();b&&(nodeshot.layout.$overlay.click(function(){nodeshot.overlay.close()}),nodeshot.layout.$overlayInner.click(function(){return!1}))},initClose:function(){nodeshot.layout.$overlayInner.prepend('<a class="close"></a>');nodeshot.layout.$overlayInner.find(".close").click(function(){nodeshot.overlay.close()})},centerVertically:function(a,b){var c=
nodeshot.layout.verticalCenter(nodeshot.layout.$overlayInner);c<0&&(c=10);a?nodeshot.layout.$overlayInner.animate({"margin-top":c},b):nodeshot.layout.$overlayInner.css("margin-top",c)},bindCancelButton:function(){$("#cancel").click(function(){nodeshot.overlay.close()})},bindSubmitForm:function(a){$("#nodeshot-form").submit(function(b){form=$(this);b.preventDefault();if(!nodeshot.sending)a(form),nodeshot.sending=!0})},close:function(){nodeshot.overlay.removeMask();nodeshot.layout.$overlay.remove();
nodeshot.layout.$overlay=!1;nodeshot.layout.$overlayInner=!1;nodeshot.layout.setFullScreen();if(nodeshot.gmap.clickListener)google.maps.event.removeListener(nodeshot.gmap.clickListener),nodeshot.gmap.clickListener=null;nodeshot.gmap.addressMarker&&nodeshot.gmap.removeAddressMarker()}},dialog:{open:function(a,b){$("body").append('<div id="nodeshot-modal"><div id="nodeshot-modal-message">'+a+'</div><a class="button green" id="nodeshot-modal-close">ok</a></div>');nodeshot.layout.$dialog=$("#nodeshot-modal");
nodeshot.overlay.addMask(0.5,!0);nodeshot.layout.$dialog.css({opacity:0,display:"block",left:nodeshot.layout.horizontalCenter(nodeshot.layout.$dialog),top:nodeshot.layout.verticalCenter(nodeshot.layout.$dialog)}).animate({opacity:1},500);nodeshot.layout.$body.bind("keyup",function(a){a=a.keyCode?a.keyCode:a.which;if(a==13||a==27)nodeshot.dialog.close(b),nodeshot.layout.$body.unbind("keyup")});$("#nodeshot-modal-close").click(function(){nodeshot.dialog.close(b)})},close:function(a){nodeshot.layout.$dialog.fadeOut(500,
function(){nodeshot.layout.$dialog.remove();nodeshot.layout.$dialog=!1});nodeshot.overlay.removeMask();a&&a()}},contact:{init:function(a){nodeshot.overlay.addMask(0.7);nodeshot.overlay.showLoading();$.get(a,function(b){nodeshot.overlay.hideLoading();nodeshot.overlay.open(b);nodeshot.overlay.bindCancelButton();nodeshot.overlay.bindSubmitForm(function(b){nodeshot.contact.submit(a,b)})})},submit:function(a,b){nodeshot.overlay.showLoading();$("#nodeshot-mask").css({zIndex:11,opacity:0.7});nodeshot.layout.$overlay.css("z-index",
"10");var c=b.serialize();$.post(a,c,function(b){nodeshot.overlay.hideLoading();$(b).find("#success").length<1?($("#nodeshot-mask").css({zIndex:10,opacity:0.5}),nodeshot.layout.$overlay.css("z-index","11"),nodeshot.layout.$overlay.html(b),nodeshot.layout.$overlay=$("#nodeshot-overlay"),nodeshot.layout.$overlayInner=$("#nodeshot-overlay-inner"),nodeshot.overlay.centerVertically(),nodeshot.overlay.initClose(),nodeshot.overlay.bindCancelButton(),nodeshot.overlay.bindSubmitForm(function(b){nodeshot.contact.submit(a,
b)})):$("#nodeshot-overlay-inner").fadeOut(500,function(){nodeshot.dialog.open("Messaggio inviato con successo.",nodeshot.overlay.close)});nodeshot.sending=!1});return!1},link:function(){$("#contact-link").click(function(a){a.preventDefault();nodeshot.contact.init(this.href)})}},node:{add:function(){nodeshot.overlay.addMask();nodeshot.overlay.showLoading();$.get(nodeshot.url.index+"node/add/",function(a){nodeshot.overlay.open(a);nodeshot.gmap.newMarker&&($("#id_lat").val(nodeshot.gmap.newMarker.getPosition().lat()),
$("#id_lng").val(nodeshot.gmap.newMarker.getPosition().lng()),nodeshot.gmap.removeNewMarker());nodeshot.overlay.bindCancelButton();nodeshot.overlay.bindSubmitForm(function(a){nodeshot.node.submit(a)})})},submit:function(a){nodeshot.overlay.showLoading();$("#nodeshot-mask").css({zIndex:11,opacity:0.7});nodeshot.layout.$overlay.css("z-index","10");a=a.serialize();$.post(nodeshot.url.index+"node/add/",a,function(a){nodeshot.overlay.hideLoading();a.length>=10?($("#nodeshot-mask").css({zIndex:10,
opacity:0.5}),nodeshot.layout.$overlay.css("z-index","11"),nodeshot.layout.$overlay.html(a),nodeshot.layout.$overlay=$("#nodeshot-overlay"),nodeshot.layout.$overlayInner=$("#nodeshot-overlay-inner"),nodeshot.overlay.centerVertically(),nodeshot.overlay.initClose(),nodeshot.overlay.bindCancelButton(),nodeshot.overlay.bindSubmitForm(function(a){nodeshot.node.submit(a)})):nodeshot.layout.$overlayInner.fadeOut(500,function(){nodeshot.dialog.open("Grazie per aver inserito un nuovo nodo potenziale, ti abbiamo inviato un'email con il link di conferma.",
nodeshot.overlay.close)});nodeshot.layout.setFullScreen();nodeshot.sending=!1})},bindChangePassword:function(){$("#change-password").click(function(){var a=$(this),b=$("#id_new_password");a.data("info")==void 0||a.data("info").status==0?(a.data("info",{text:a.text(),status:1}),a.text("annulla"),$("#id_new_password2").val(""),$("#id_fake_password").hide(),b.val("").show(500),$("#verify-password").show(500)):(a.text(a.data("info").text),$("#id_new_password2").val(""),$("#id_fake_password").show(500),
b.val("").hide(),$("#verify-password").hide(),a.data("info").status=0)});$("#non-field-errors").length>0&&$("#change-password").click()}},advanced:{init:function(){nodeshot.advanced.firstTimeLoadingTab=!0;$("#advanced-info").tabs({fx:{opacity:"toggle",height:"toggle",duration:400},show:function(){nodeshot.advanced.firstTimeLoadingTab?(nodeshot.overlay.centerVertically(),nodeshot.advanced.firstTimeLoadingTab=!1):nodeshot.overlay.centerVertically(!0,400)}});$(".toggle-info","#advanced-info").toggle(function(){var a=
$(this);a.parent().parent().parent().parent().find(".additional").show(300,function(){nodeshot.overlay.centerVertically(!0,300)});a.removeClass("green");a.addClass("red");a.text("\u2013 info")},function(){var a=$(this);a.parent().parent().parent().parent().find(".additional").hide(300,function(){nodeshot.overlay.centerVertically(!0,300)});a.removeClass("red");a.addClass("green");a.text("+ info")})}},distance:{links:[],calculate:function(a,b,c,d,e){a=Math.PI*a/180;c=Math.PI*c/180;b=Math.PI*(b-d)/180;
b=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos(b);b=Math.acos(b);b=b*180/Math.PI;b*=69.09;e=="K"&&(b*=1.609344);e=="N"&&(b*=0.8684);return b},add:function(a,b,c,d){a=this.links.push({link:a,from_name:b.from_name,to_name:b.to_name,$div:null,remove:function(){if(nodeshot.distance.saved_links){var a=!1;for(i=0;i<nodeshot.distance.saved_links.length;i++)nodeshot.distance.saved_links[i]&&nodeshot.distance.saved_links[i].from_name==this.from_name&&nodeshot.distance.saved_links[i].to_name==this.to_name&&
(nodeshot.distance.saved_links.remove(i),a=!0);a&&$.cookie("nodeshot_saved_distances",JSON.stringify(nodeshot.distance.saved_links),{expires:365,path:nodeshot.url.index})}this.link.setMap(null);this.$div.fadeOut(500,this.$div.remove);delete this.link},hide:function(){this.link.setMap(null);this.$div.find(".link-hide").hide();this.$div.find(".link-show").show()},show:function(){this.link.setMap(nodeshot.gmap.map);this.$div.find(".link-show").hide();this.$div.find(".link-hide").show()},save:function(){if(d)return!1;
this.$div.find(".link-save").fadeOut(500);if(nodeshot.distance.cookie==null)var a=JSON.stringify([b]);else nodeshot.distance.saved_links.push(b),a=JSON.stringify(nodeshot.distance.saved_links);$.cookie("nodeshot_saved_distances",a,{expires:365,path:nodeshot.url.index})}});a-=1;c='<div id="distance-link'+a+'" class="distance-link"><span>'+('<a class="link-node" href="javascript:nodeshot.gmap.goToNode(\''+("nodeshot.nodes."+nodeshot.status_choices[b.from_status]+"."+b.from_slug)+"')\">"+b.from_name+
"</a>")+" - "+('<a class="link-node" href="javascript:nodeshot.gmap.goToNode(\''+("nodeshot.nodes."+nodeshot.status_choices[b.to_status]+"."+b.to_slug)+"')\">"+b.to_name+"</a>")+": <b>"+c+" km</b> ";c=c+'<a href="javascript:nodeshot.distance.links['+a+'].show()" class="link-show">mostra</a><a href="javascript:nodeshot.distance.links['+a+'].hide()" class="link-hide">nascondi</a>';d||(c=c+'<a href="javascript:nodeshot.distance.links['+a+'].save()" class="link-save">salva</a>');c=c+'<a href="javascript:nodeshot.distance.links['+
a+'].remove()" class="link-remove">elimina</a>';c+="</span></div>";nodeshot.layout.$sideLinks.prepend(c);this.links[a].$div=$("#distance-link"+a);this.links[a].$div.fadeIn(500);nodeshot.layout.setFullScreen()}},gmap:{newMarker:"",newMarkerListener:"",clickListener:"",infoWindow:new google.maps.InfoWindow,init:function(){nodeshot.layout.$map=$("#map_canvas");nodeshot.layout.$sideLinks=$("#side-links");var a=new google.maps.LatLng(nodeshot.gmap.map_center.lat,nodeshot.gmap.map_center.lng);nodeshot.gmap.map=
new google.maps.Map(document.getElementById("map_canvas"),{zoom:12,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP});nodeshot.gmap.geocoder=new google.maps.Geocoder;var b=setInterval(function(){if(nodeshot.nodes.active!=void 0&&(clearInterval(b),nodeshot.gmap.drawNodes(nodeshot.status_choices.a),nodeshot.gmap.drawNodes(nodeshot.status_choices.h),nodeshot.layout.$potential[0].checked&&nodeshot.gmap.drawNodes(nodeshot.status_choices.p),!nodeshot.gmap.map_center.is_default)){var a=nodeshot.gmap.map_center.node.split(";");
nodeshot.gmap.goToNode(nodeshot.nodes[nodeshot.status_choices[a[1]]][a[0]])}},200);nodeshot.layout.$loading&&(nodeshot.overlay.removeMask(),nodeshot.overlay.hideLoading(),nodeshot.layout.setFullScreen())},drawNodes:function(a){var b=nodeshot.nodes[a],c=nodeshot.url.media+"images/marker_"+a+".png",d;for(d in b){var e=new google.maps.LatLng(b[d].lat,b[d].lng);b[d].marker=new google.maps.Marker({position:e,map:nodeshot.gmap.map,title:b[d].name,icon:c});b[d].marker.slug=b[d].slug;b[d].marker.setMap(nodeshot.gmap.map);
b[d].listener=google.maps.event.addListener(b[d].marker,"click",nodeshot.gmap.clickMarker(b[d].marker,b[d]))}if(a==nodeshot.status_choices.a){a=nodeshot.nodes.links.length+1;b=a-1;for(c=nodeshot.layout.$linkQuality.find("input:checked").val();--a;)d=nodeshot.nodes.links[b-a],d.gmap=nodeshot.gmap.drawLink(d.from_lat,d.from_lng,d.to_lat,d.to_lng,d[c])}},removeMarkers:function(a){for(var b in nodeshot.nodes[a])nodeshot.nodes[a][b].marker.setMap(null),google.maps.event.removeListener(nodeshot.nodes[a][b].listener),
delete nodeshot.nodes[a][b].marker,delete nodeshot.nodes[a][b].listener;a==nodeshot.status_choices.a&&this.removeLinks()},removeLinks:function(){for(var a=nodeshot.nodes.links.length+1,b=a-1;--a;)nodeshot.nodes.links[b-a].gmap.setMap(null),delete nodeshot.nodes.links[b-a].gmap},goToNode:function(a){nodeshot.gmap.check$potential(nodeshot.status_choices[a.status]);typeof a=="string"&&(a=eval(a));a.marker?(google.maps.event.trigger(a.marker,"click"),nodeshot.gmap.map.panTo(a.marker.getPosition()),nodeshot.gmap.map.setZoom(13)):
nodeshot.dialog.open("Il nodo non esiste.")},newNodeMarker:function(a){nodeshot.gmap.removeNewMarker();var b=new google.maps.Marker({position:a,map:nodeshot.gmap.map,icon:nodeshot.url.media+"images/marker_new.png"});nodeshot.gmap.infoWindow=new google.maps.InfoWindow({content:'<div id="confirm-new"><h2>Mi hai posizionato bene?</h2><a href="javascript:nodeshot.node.add()" class="green">Si</a><a href="javascript:nodeshot.gmap.removeNewMarker()" class="red">No</a></div>'});nodeshot.gmap.infoWindow.open(nodeshot.gmap.map,
b);nodeshot.gmap.newMarkerListener=google.maps.event.addListener(b,"click",function(){nodeshot.gmap.infoWindow.open(nodeshot.gmap.map,b)});nodeshot.gmap.newMarker=b},removeNewMarker:function(){nodeshot.gmap.newMarker&&nodeshot.gmap.newMarker.setMap(null);nodeshot.gmap.newMarkerListener&&google.maps.event.removeListener(nodeshot.gmap.newMarkerListener);nodeshot.gmap.newMarker=null;nodeshot.gmap.newMarkerListener=null},clickMarker:function(a,b){return function(){nodeshot.layout.$overlay&&nodeshot.overlay.close();
nodeshot.overlay.addMask(0.7);nodeshot.overlay.showLoading();$.get(nodeshot.url.index+"node/info/"+b.id+"/",function(c){nodeshot.gmap.infoWindow.domready&&google.maps.event.removeListener(nodeshot.gmap.infoWindow.domready);nodeshot.gmap.infoWindow.domready=google.maps.event.addListener(nodeshot.gmap.infoWindow,"domready",function(){$(".tabs").tabs({create:function(){$this=$(this);nodeshot.tab0Height=$this.find(".ui-tabs-panel").eq($this.tabs("option","selected")).height()},show:function(){$this=$(this);
if($this.tabs("option","selected")===1){var a=$this.find(".ui-tabs-panel").eq(1);nodeshot.tab1Height=a.height();nodeshot.tab0Height>nodeshot.tab1Height&&a.height(nodeshot.tab0Height)}},select:function(a,b){if(b.tab.id=="advanced-link")return nodeshot.overlay.addMask(0.8,!0),nodeshot.overlay.showLoading(),$.get($(b.tab).attr("data-url"),function(a){nodeshot.overlay.open(a,!0);nodeshot.advanced.init();nodeshot.overlay.bindCancelButton()}),!1}});nodeshot.contact.link();var a=$("#distance-search");nodeshot.layout.bindFocusBlur(a);
nodeshot.distanceSearchCache=[];a.autocomplete({minLength:3,source:function(a,b){var c=a.term;c in nodeshot.distanceSearchCache?b(nodeshot.distanceSearchCache[c]):lastXhr=$.getJSON("search/"+a.term+"/",function(a,c,d){d===lastXhr&&a!=null&&a.length>0?b(a):b("")})},select:function(c,f){nodeshot.gmap.drawDistanceLink({from_name:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].name,from_slug:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].jslug,from_lat:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].lat,
from_lng:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].lng,from_status:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].status,to_name:f.item.name,to_slug:f.item.value,to_lat:f.item.lat,to_lng:f.item.lng,to_status:f.item.status});a.val(f.item.label);return!1},focus:function(a,b){$(this).val(b.item.label);return!1}});$("#distance-select").change(function(){var a=$(this),c=a.val().split(";"),d=c[0].replace(",","."),g=c[1].replace(",","."),h=c[2],c=c[3];nodeshot.gmap.drawDistanceLink({from_name:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].name,
from_slug:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].jslug,from_lat:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].lat,from_lng:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].lng,from_status:nodeshot.nodes[nodeshot.status_choices[b.status]][b.jslug].status,to_name:a.find('option[value="'+a.val()+'"]').text(),to_slug:h,to_lat:d,to_lng:g,to_status:c})});nodeshot.layout.setFullScreen()});nodeshot.gmap.infoWindow.setContent(c);nodeshot.gmap.infoWindow.maxWidth=
500;nodeshot.gmap.infoWindow.open(nodeshot.gmap.map,a);nodeshot.overlay.hideLoading();nodeshot.layout.$dialog||nodeshot.overlay.removeMask()})}},drawLink:function(a,b,c,d,e){a=new google.maps.Polyline({path:[new google.maps.LatLng(a,b),new google.maps.LatLng(c,d)],strokeColor:[null,"#00ff00","#ffff00","#ee0000","#5f0060"][e],strokeOpacity:0.4,strokeWeight:5});a.setMap(nodeshot.gmap.map);return a},drawDistanceLink:function(a,b){if(!a)return!1;a.from_lat=parseFloat(a.from_lat);a.from_lng=parseFloat(a.from_lng);
a.to_lat=parseFloat(a.to_lat);a.to_lng=parseFloat(a.to_lng);nodeshot.gmap.check$potential(nodeshot.status_choices[a.to_status]);this.check$potential(nodeshot.status_choices[a.from_status]);this.check$potential(nodeshot.status_choices[a.to_status]);var c=nodeshot.gmap.drawLink(a.from_lat,a.from_lng,a.to_lat,a.to_lng,4),d=nodeshot.distance.calculate(a.from_lat,a.from_lng,a.to_lat,a.to_lng,"K"),d=Math.round(d*Math.pow(10,2))/Math.pow(10,2);$("#result").html(d);$("#result-row").fadeIn(500);nodeshot.distance.add(c,
a,d,b);return!0},removeAddressMarker:function(){nodeshot.gmap.addressMarker.setMap(null);delete nodeshot.gmap.addressMarker},check$potential:function(a){if(a==nodeshot.status_choices.p&&!nodeshot.layout.$potential[0].checked)nodeshot.layout.$potential[0].checked=!0,nodeshot.gmap.drawNodes(nodeshot.status_choices.p),$.cookie("nodeshot_potential_nodes","true",{expires:365,path:nodeshot.url.index})},searchAddress:function(a,b){nodeshot.gmap.geocoder&&nodeshot.gmap.geocoder.geocode({address:a},function(a,
d){if(d==google.maps.GeocoderStatus.OK){nodeshot.overlay.removeMask();var e=function(a){a=new google.maps.LatLng(a[0].geometry.location.lat(),a[0].geometry.location.lng());nodeshot.gmap.addressMarker&&nodeshot.gmap.removeAddressMarker();nodeshot.gmap.addressMarker=new google.maps.Marker({position:a,map:nodeshot.gmap.map});nodeshot.gmap.map.panTo(a);nodeshot.gmap.map.setZoom(16)};nodeshot.layout.$overlayInner.hasClass("ui-draggable")?e(a):(nodeshot.layout.$overlayInner.css({top:nodeshot.layout.$overlayInner.css("margin-top"),
left:nodeshot.layout.$overlayInner.position().left,position:"absolute",marginTop:0}),nodeshot.layout.$overlay.css({width:0,height:0}),nodeshot.layout.$overlayInner.animate({top:50,left:80},function(){nodeshot.layout.$overlayInner.draggable();e(a)}))}else b.addClass("error")})},unload:function(){delete nodeshot.layout.$map;delete nodeshot.layout.$sideLinks;this.removeMarkers(nodeshot.status_choices.a);this.removeMarkers(nodeshot.status_choices.h);nodeshot.layout.$potential[0].checked&&this.removeMarkers(nodeshot.status_choices.p);
delete nodeshot.gmap.map;delete nodeshot.gmap.geocoder}},infoTab:{init:function(){nodeshot.layout.$infoTable=$("#info-table");nodeshot.layout.$infoWrapper=$("#info-wrapper");nodeshot.layout.$tableWrapper=$("#table-wrapper");nodeshot.layout.$signalbar=$(".signalbar");nodeshot.layout.$infoTable.tablesorter();len=nodeshot.layout.$signalbar.length+1;for(ilen=len-1;--len;){var a=nodeshot.layout.$signalbar.eq(ilen-len),b=a.attr("data-value");a.progressBar(b)}},scrollTo:function(a){var b=$("tr."+a);b.length>
0?(a=nodeshot.layout.$tableWrapper.scrollTop()+b.position().top-100,nodeshot.layout.$tableWrapper.animate({scrollTop:a},"slow",function(){var a=b.find("td");a.css("background-color","#ffffc8");setTimeout(function(){a.css("background-color","#fff")},2500)})):setTimeout(function(){nodeshot.dialog.open("Il nodo selezionato non \u00e8 presente in questa lista.")},300)},unload:function(){delete nodeshot.layout.$infoTable;delete nodeshot.layout.$infoWrapper;delete nodeshot.layout.$tableWrapper;delete nodeshot.layout.$signalbar}},
easterEgg:function(){var a=[];$(document).keydown(function(b){a.push(b.keyCode);a.toString().indexOf("38,38,40,40,37,39,37,39,66,65")>=0&&($(document).unbind("keydown",arguments.callee),$.getScript("http://www.cornify.com/js/cornify.js",function(){cornify_add();$(document).keydown(cornify_add)}))})}};